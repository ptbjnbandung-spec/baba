<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>QR Scanner</title>
<style>
  body { font-family: arial; padding: 20px; }
  #video { width: 320px; height: 240px; background: #000; }
  button { padding: 8px 12px; margin: 5px; }
</style>
</head>
<body>

<h2>QR Scanner (Laptop Mode)</h2>

<button id="startBtn">Start Camera</button>
<button id="stopBtn" disabled>Stop Camera</button>

<br><br>

<video id="video" playsinline></video>

<p>Hasil scan: <span id="output" style="font-weight:bold"></span></p>

<script type="module">
import { BrowserMultiFormatReader } 
  from "https://unpkg.com/@zxing/library@0.19.1/esm/index.min.js";

const video = document.getElementById('video');
const output = document.getElementById('output');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');

let stream = null;
let reader = null;

startBtn.onclick = async () => {
  try {
    reader = new BrowserMultiFormatReader();
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "user" }  // laptop selalu kamera depan
    });
    video.srcObject = stream;
    await video.play();

    startBtn.disabled = true;
    stopBtn.disabled = false;

    scanLoop();
  } catch (e) {
    alert("Gagal buka kamera: " + e);
  }
};

stopBtn.onclick = () => {
  if (stream) {
    stream.getTracks().forEach(t => t.stop());
  }
  video.srcObject = null;

  startBtn.disabled = false;
  stopBtn.disabled = true;
};

async function scanLoop() {
  if (!reader) return;

  try {
    const result = await reader.decodeOnceFromVideoElement(video);
    output.textContent = result.text;
    setTimeout(scanLoop, 700);
  } catch (e) {
    requestAnimationFrame(scanLoop);
  }
}
</script>

</body>
</html>
